<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <title>Reserva de Computadora</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 30px; background-color: #f4f7f8; }
    h2 { color: #333; }
    label { font-weight: bold; margin-top: 12px; display: block; }
    select, input {
      width: 100%;
      margin: 8px 0 16px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h2>Reserva de Computadora</h2>

  <form id="reservaForm" onsubmit="validarYEnviar(); return false;">
    <label>Nombre del estudiante:</label>
    <input type="text" name="nombre" required>

    <label>Correo electrónico:</label>
    <input type="email" name="correo" required>

    <label>Sede:</label>
    <select name="sede" required onchange="actualizarLaboratorios(this.value)">
      <option value="">-- Selecciona Sede --</option>
      <option value="Central">Central</option>
      <option value="San Luis">San Luis</option>
      <option value="Sede República de Chile">Sede República de Chile</option>
      <option value="SJL">SJL</option>
      <option value="SJM Belisario">SJM Belisario</option>
      <option value="SJM Los chinos">SJM Los chinos</option>
    </select>

    <label>Laboratorio:</label>
    <select name="laboratorio" required id="laboratorioSelect">
      <option value="">-- Selecciona Laboratorio --</option>
    </select>

    <label>Día:</label>
    <select name="dia" required>
      <option value="">-- Selecciona Día --</option>
      <option value="Lunes">Lunes</option>
      <option value="Martes">Martes</option>
      <option value="Miércoles">Miércoles</option>
      <option value="Jueves">Jueves</option>
      <option value="Viernes">Viernes</option>
      <option value="Sábado">Sábado</option>
    </select>

    <label>Horario:</label>
    <select name="horario" required>
      <option value="">-- Selecciona Horario --</option>
      <option value="10:15">10:15</option>
      <option value="11:15">11:15</option>
      <option value="12:15">12:15</option>
      <option value="13:15">13:15</option>
      <option value="14:15">14:15</option>
      <option value="15:15">15:15</option>
      <option value="16:15">16:15</option>
      <option value="17:15">17:15</option>
      <option value="18:15">18:15</option>
      <option value="19:15">19:15</option>
    </select>

    <label>Computadora:</label>
    <select name="pc" required id="pcSelect">
      <option value="">-- Selecciona PC --</option>
    </select>

    <button type="submit">Reservar</button>
  </form>

  <script>
    const laboratoriosPorSede = {
      "Central": { "601": 29, "602": 24 },
      "San Luis": { "202": 19 },
      "Sede República de Chile": { "203": 13 },
      "SJL": { "100": 8, "108": 22 },
      "SJM Belisario": { "101-B": 8 },
      "SJM Los chinos": { "101-C": 14 }
    };

    function actualizarLaboratorios(sede) {
      const labSelect = document.getElementById("laboratorioSelect");
      const pcSelect = document.getElementById("pcSelect");
      labSelect.innerHTML = '<option value="">-- Selecciona Laboratorio --</option>';
      pcSelect.innerHTML = '<option value="">-- Selecciona PC --</option>';

      if (laboratoriosPorSede[sede]) {
        for (const lab in laboratoriosPorSede[sede]) {
          const option = document.createElement("option");
          option.value = lab;
          option.text = lab;
          labSelect.appendChild(option);
        }
      }
    }

    document.getElementById("laboratorioSelect").addEventListener("change", function () {
      const sede = document.querySelector("select[name='sede']").value;
      const lab = this.value;
      const pcSelect = document.getElementById("pcSelect");
      pcSelect.innerHTML = '<option value="">-- Selecciona PC --</option>';

      if (laboratoriosPorSede[sede] && laboratoriosPorSede[sede][lab]) {
        const pcs = laboratoriosPorSede[sede][lab];
        for (let i = 1; i <= pcs; i++) {
          const nombrePC = `${sede}-${lab}-PC${i < 10 ? '0' + i : i}`;
          const option = document.createElement("option");
          option.value = nombrePC;
          option.text = nombrePC;
          pcSelect.appendChild(option);
        }
      }
    });

function validarYEnviar() {
  const form = document.getElementById("reservaForm");
  const formData = new FormData(form); // Usar FormData directamente
  
fetch("https://script.google.com/macros/s/AKfycbweditwPTxnuDNaoV_DaMBt0eDezZjoLlwNhjO_71LdLBUyKnAaFHPdJjhxbE8ug1O0/exec", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  body: new URLSearchParams(new FormData(document.getElementById("reservaForm")))
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    alert("Reserva exitosa!");
  } else {
    throw new Error(data.error);
  }
})
.catch(error => {
  alert("Error: " + error.message);
});
  </script>
</body>
</html>